@model NIDO_TimeAttandance_MVC.Areas.Reports.Models.ModelMonthlyRepot

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
}


<link href="~/assests/abc/datatables.min.css" rel="stylesheet" />

<div class="row"><br /></div>
<form id="frm-Report">
    <div class="stockprice-feed-project-area">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-6 col-sm-12 col-xs-12">
                    <div class="income-dashone-total shadow-reset nt-mg-b-30">
                        <div class="income-dashone-pro">
                            <div class="income-rate-total">
                                <div class="price-adminpro-rate">
                                    <div class="row">
                                        <div class="form-group data-custon-pick data-custom-mg data_5">
                                            <div class="input-daterange input-group" id="datepicker">
                                                <div class="input-daterange input-group">
                                                    @if (ViewBag.ReportsName != null)
                                                    {
                                                        <span class="input-group-addon">Report Name</span>
                                                        @Html.DropDownListFor(model => model.ReportID, ViewBag.ReportsName as IEnumerable<SelectListItem>, "Please Select Report Name", new { @class = "form-control", required = "*", id = "ReportId" })
                                                    }

                                                    <span id="Date-label" class="input-group-addon">Select Date</span>
                                                    <span id="startDate-label" class="input-group-addon">Select Date Range</span>
                                                    <input type="text" class="form-control" id="startDate" placeholder="Please select From Date" required name="start" autocomplete="off" />

                                                    <span id="endDate-label" class="input-group-addon">to</span>
                                                    <input type="text" class="form-control" id="endDate" placeholder="Please select To Date" required name="end" autocomplete="off" />

                                                   

                                                    <span class="input-group-addon bankdetails ">Bank Name</span>
                                                    @Html.DropDownListFor(model => model.bankId, ViewBag.BankList as IEnumerable<SelectListItem>, "Please Select Bank Name", new { @class = "form-control bankdetails ", id = "bankId" })
                                                  


                                                    @*<span  id="Date-label" class="input-group-addon">Select Date</span>
                                                    <input type="text" class="form-control" id="Date" placeholder="Pleaseassas To Date" required name="end" autocomplete="off" />*@

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="stockprice-feed-project-area">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-6 col-sm-12 col-xs-12">
                    <div class="income-dashone-total shadow-reset nt-mg-b-30">
                        <div class="income-title">
                            <div class="main-income-head">
                                <h2>.</h2>

                                <div class="main-income-phara visitor-cl">
                                    <p>
                                        Please Select Employee
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="income-dashone-pro">
                            <div class="income-rate-total">
                                <div class="price-adminpro-rate">


                                    <table id="tableReport" class="display cell-border compact stripe order-column">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>Ecode</th>
                                                <th>Name</th>
                                                <th>Company</th>
                                                <th>Department</th>
                                                <th>Designation</th>
                                                <th>Employee Type</th>
                                                <th>Active</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in ViewBag.Employees)
                                            {
                                            <tr>
                                                <td>@item.EmpID</td>
                                                <td>@item.EmpCode</td>
                                                <td>@item.EmpName</td>
                                                <td>@item.CompanyName</td>
                                                <td>@item.DepartmentDesc</td>
                                                <td>@item.DesignationDesc</td>
                                                <td>@item.EmployeeType</td>
                                                @if (@item.Active == true)
                                                {
                                                    <td style="color: red;">In Active</td>
                                                }
                                                else
                                                {
                                                    <td style="color: green;">Active</td>
                                                }

                                            </tr>
                                            }


                                        </tbody>
                                        <br />
                                        <tfoot>

                                            <tr>
                                                <th style="visibility:hidden;"></th>
                                                <th style="visibility:hidden;">Ecode</th>
                                                <th style="visibility:hidden;">Name</th>
                                                <th>Company</th>
                                                <th>Department</th>
                                                <th>Designation</th>
                                                <th>Employee Type</th>
                                                <th>Active/InActive</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <div class="button-drop-style-one" style="float:left">
                                    @if (ViewBag.ReportsName != null)
                                    {
                                        <button type="submit" class="btn btn-custon-four btn-success primary-btn-cl">
                                            Generate Report
                                            <i class="adminpro-icon adminpro-avatar"></i>
                                        </button>
                                    }
                                    else
                                    {
                                        <button type="submit" class="btn btn-custon-four btn-success primary-btn-cl">
                                            Generate
                                            <i class="adminpro-icon adminpro-avatar"></i>
                                        </button>
                                    }

                                </div>
                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<a id="modalClcik" href="#" data-toggle="modal" data-target="#InformationproModalalert"></a>

<div id="InformationproModalalert" class="modal modal-adminpro-general fullwidth-popup-InformationproModal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 200% !important;right: 50%;">
            <div class="modal-close-area modal-close-df">
                <a class="close" data-dismiss="modal" href="#"><i class="fa fa-close"></i></a>
            </div>
            <div class="modal-body">
                <div class="sparkline13-graph">
                    <div class="datatable-dashv1-list custom-datatable-overright">
                        <table id="example" data-toggle="table" data-pagination="true" data-search="true" data-key-events="true" data-resizable="true" data-cookie="true" data-cookie-id-table="saveId" data-click-to-select="true" data-toolbar="#toolbar">
                            <thead>
                                <tr>
                                    @*<th data-field="state" data-checkbox="true"></th>*@
                                    <th>Report Name</th>
                                    @*<th>Category</th>*@
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ViewBag.ReportsName)
                                {
                                    <tr>
                                        @*<td></td>*@
                                        <td id="@item.Value"> @item.Text </td>
                                        @*<td>Category</td>*@
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>










<!-- icheck JS
    ============================================ -->
<script src="~/Assests/Home/js/icheck/icheck.min.js"></script>
<script src="~/Assests/Home/js/icheck/icheck-active.js"></script>
<script src="~/Assests/abc/datatables.min.js"></script>
<script src="~/Assests/abc/dataTables.checkboxes.min.js"></script>
<script>
    $(document).ready(function () {
        var table = $('#tableReport').DataTable({
            'columnDefs': [
                {
                    'targets': 0,
                    'checkboxes': {
                        'selectRow': true
                    }
                }
            ],
            'select': {
                'style': 'multi'
            },
            'order': [[1, 'asc']],
            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var select = $('<select class="chosen-select form-control"><option value="">Filter</option></select>')
                        .appendTo($(column.footer()).empty())
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );

                            column
                                .search(val ? '^' + val + '$' : '', true, false)
                                .draw();
                        });

                    column.data().unique().sort().each(function (d, j) {
                        select.append('<option value="' + d + '">' + d + '</option>')
                    });
                });
            },

        });

        // Handle form submission event
        $('#frm-Report').on('submit', function (e) {
            var form = this;
            var arr = new Array();

            var ReportID = $("#ReportId").val();
            

            var DateFrom = $('#startDate').val();
            var DateTo = $('#endDate').val();
            var BankId = $("#bankId").val();
            var start = new Date(DateFrom);
            var end = new Date(DateTo);

            debugger
            if (ReportID == 15) {
                end = new Date(DateFrom);
                end.setDate(end.getDate() + 1);
            }
            if (ReportID == 5017) {


                start = new Date();
                end.setDate(end.getDate());


                end = new Date();
                end.setDate(end.getDate() + 1);

            }

        
          
            if (start <= end) {
                var rows_selected = table.column(0).checkboxes.selected();

                if (rows_selected.length == 0) {
                    SendNotif("Ooopss!", "No User is Selected", 'error');
                    return false;
                }

                // Iterate over all selected checkboxes
                $.each(rows_selected, function (index, rowId) {
                    // Create a hidden element
                    arr.push(rowId);
                    $(form).append(
                        $('<input>')
                            .attr('type', 'hidden')
                            .attr('name', 'id[]')

                            .val(rowId)
                    );
                });
                $(".se-pre-con").fadeIn("slow");


                if (document.location.pathname.includes("Reports")) {
                    FormSubmitReport(arr, DateFrom, DateTo, ReportID,BankId);
                }
                else {
                    FormSubmitGenrate(arr, DateFrom, DateTo);
                }
            }
            else {
                SendNotif('Error!', 'Invalid Date Range', 'error');
            }
            // Prevent actual form submission
            e.preventDefault();
        });
        function FormSubmitReport(arr, DateFrom, DateTo, ReportID, BankId) {

            let queryString = arr + '?' + DateFrom + '?' + DateTo + '?' + ReportID + '?' + BankId;

            //'<%Session["ReportQuery"] = "' + queryString + '"; %>';

           // window.location = '/Report/Generate?data=' + arr + '?' + DateFrom + '?' + DateTo + '?' + ReportID + '?' + BankId;


            $.ajax({
                type: "Post",
                url: "/Reports/Report/Generate",

                data: { data: queryString },
                success: function (data) {

                    if (data.Status == "Success") {
                        window.location = data.URL
                    }
                    else {
                        SendNotif("Ooopss!", "Something is wrong", 'error');
                    }
                },
                error: function (data) {
                    SendNotif("Ooopss!", "Something is wrong", 'error');
                    $(".se-pre-con").fadeOut("slow");
                }
            })
        }


        function FormSubmitGenrate(arr, DateFrom, DateTo) {
          
            window.location = '/Adjustment/Generate?data=' + arr + '?' + DateFrom + '?' + DateTo;
        }
    });




</script>

<script>
    $('#ReportId').click(function () {

        $('#ReportId').blur();
        $('#modalClcik').click();
        $('#ReportId').show();
    });
</script>

<script type='text/javascript'>
    $(document).ready(function () {
        $("#Date-label").hide();
        $("#Date").hide();
        $('#ReportId option').hide();
        $(".bankdetails").hide()
        $('#modalClcik').click();
        $("#example tbody").delegate("tr", "click", function (e) {
            var column2 = $('td', this).attr("id");
            $(".close").click();
            $("#ReportId").val(column2);

            let ReportID = $("#ReportId").val();
            if (ReportID == 3017) {
                $(".bankdetails").show();
            }
            else {
                $("#bankId").val('');
                $(".bankdetails").hide();

            }
            if (ReportID == 5017) {


                $("#startDate-label").hide();
                $("#startDate").hide();
                $("#startDate").removeAttr("required")
                $("#endDate-label").hide();
                $("#endDate").hide();
                $("#endDate").removeAttr("required")


                $("#startDate").val('');
                $("#endDate").val('');

            }
            else {
                $("#startDate-label").show();
                $("#startDate").show();
                $("#startDate").attr("required",true)

                $("#endDate-label").show();
                $("#endDate").show();
                $("#endDate").attr("required", true)


            }
            

            //if (column2 == 15) {
            //    $("#startDate-label").hide();


            //    $("#endDate-label").hide();
            //    $("#endDate").hide();
            //    $("#endDate").val(" 03 / 30 / 2020")
            //    $("#Date-label").show();
            //    $("#Date").hide();

            //}
        });
    });
</script>
